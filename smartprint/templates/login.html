<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PrintMe - Smart Printing Solutions</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet"/>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <!-- Google Sign-In -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root {
      --primary-color: #2563eb;
      --primary-hover: #1d4ed8;
      --secondary-color: #f8fafc;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border-color: #e2e8f0;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      color: var(--text-primary);
    }

    .login-container {
      background: white;
      border-radius: 16px;
      box-shadow: var(--shadow-lg);
      max-width: 400px;
      width: 100%;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .login-header {
      background: linear-gradient(135deg, var(--primary-color), #3b82f6);
      color: white;
      padding: 2rem 1.5rem 1.5rem;
      text-align: center;
      position: relative;
    }

    .login-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
      pointer-events: none;
    }

    .brand-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 1rem;
      position: relative;
      z-index: 2;
    }

    .brand-logo i {
      font-size: 2.5rem;
      opacity: 0.9;
    }

    .brand-title {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 2;
    }

    .brand-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
      font-weight: 400;
      position: relative;
      z-index: 2;
    }

    .login-body {
      padding: 2rem 1.5rem;
    }

    .welcome-text {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .welcome-text h2 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .welcome-text p {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .login-tabs {
      display: flex;
      background: var(--secondary-color);
      border-radius: 12px;
      padding: 4px;
      margin-bottom: 1.5rem;
    }

    .tab-button {
      flex: 1;
      padding: 12px 16px;
      background: none;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      color: var(--text-secondary);
      transition: all 0.2s ease;
      font-size: 0.9rem;
    }

    .tab-button.active {
      background: white;
      color: var(--primary-color);
      box-shadow: var(--shadow-sm);
    }

    .login-form {
      display: none;
    }

    .login-form.active {
      display: block;
    }

    .google-signin-container {
      text-align: center;
      margin-bottom: 1rem;
    }

    .signin-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .form-control {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.2s ease;
      background: white;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn-primary {
      width: 100%;
      padding: 12px;
      border: none;
      background: var(--primary-color);
      color: white;
      font-weight: 600;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 0.5rem;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    .forgot-password {
      text-align: center;
      margin-top: 1rem;
    }

    .forgot-password a {
      color: var(--primary-color);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .forgot-password a:hover {
      text-decoration: underline;
    }

    /* Welcome Screen */
    #welcomeScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary-color) 0%, #3b82f6 100%);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: white;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #welcomeScreen.show {
      opacity: 1;
    }

    #welcomeMessage {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 2rem;
      text-align: center;
    }

    .welcome-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .welcome-status {
      font-size: 1rem;
      opacity: 0.9;
    }

    /* Mobile Optimizations */
    @media (max-width: 480px) {
      body {
        padding: 12px;
      }

      .login-container {
        max-width: 100%;
        border-radius: 12px;
      }

      .login-header {
        padding: 1.5rem 1rem 1rem;
      }

      .brand-title {
        font-size: 1.5rem;
      }

      .brand-subtitle {
        font-size: 0.8rem;
      }

      .login-body {
        padding: 1.5rem 1rem;
      }

      .welcome-text h2 {
        font-size: 1.25rem;
      }

      .tab-button {
        padding: 10px 12px;
        font-size: 0.85rem;
      }

      .form-control {
        padding: 10px 14px;
        font-size: 0.95rem;
      }

      .btn-primary {
        padding: 10px;
        font-size: 0.95rem;
      }

      #welcomeMessage {
        font-size: 1.5rem;
        padding: 0 1rem;
      }
    }

    @media (max-width: 360px) {
      .login-header {
        padding: 1rem 0.75rem 0.75rem;
      }

      .login-body {
        padding: 1rem 0.75rem;
      }

      .brand-logo i {
        font-size: 2rem;
      }

      .brand-title {
        font-size: 1.25rem;
      }
    }

    /* Landscape mobile */
    @media (max-height: 600px) and (orientation: landscape) {
      .login-header {
        padding: 1rem 1.5rem 0.75rem;
      }

      .brand-logo {
        margin-bottom: 0.5rem;
      }

      .brand-logo i {
        font-size: 2rem;
      }

      .brand-title {
        font-size: 1.25rem;
      }

      .brand-subtitle {
        font-size: 0.8rem;
      }

      .login-body {
        padding: 1rem 1.5rem;
      }

      .welcome-text {
        margin-bottom: 1rem;
      }

      .welcome-text h2 {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body>

<!-- Welcome Screen -->
<div id="welcomeScreen">
  <div id="welcomeMessage">Welcome to PrintMe</div>
  <div class="welcome-spinner"></div>
  <div class="welcome-status">Signing you in...</div>
</div>

<div class="login-container">
  <!-- Header -->
  <div class="login-header">
    <div class="brand-logo">
      <i class="bi bi-printer-fill"></i>
    </div>
    <div class="brand-title">PrintMe</div>
    <div class="brand-subtitle">Smart Printing Solutions</div>
  </div>

  <!-- Body -->
  <div class="login-body">
    <div class="welcome-text">
      <h2>Welcome Back</h2>
      <p>Sign in to access your printing dashboard</p>
    </div>

    <!-- Tab Navigation -->
    <div class="login-tabs">
      <button class="tab-button active" onclick="showTab('user')">User</button>
      <button class="tab-button" onclick="showTab('vendor')">Vendor</button>
    </div>

    <!-- User Login Form -->
    <div id="user-form" class="login-form active">
      <div class="signin-label">Continue with Google</div>
      <div class="google-signin-container">
        <div id="g_id_onload"
             data-client_id="{{ client_id }}"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin"
             data-type="standard"
             data-size="large"
             data-theme="outline"
             data-text="sign_in_with"
             data-shape="rectangular">
        </div>
      </div>
    </div>

    <!-- Vendor Login Form -->
    <div id="vendor-form" class="login-form">
      <form method="POST" action="/vendor-login/" onsubmit="vendorLogin(event)">
        {% csrf_token %}
        <div class="form-group">
          <label for="vendorId" class="form-label">Vendor ID</label>
          <input type="text" class="form-control" id="vendorId" placeholder="Enter your vendor ID" required />
        </div>
        <div class="form-group">
          <label for="vendorPassword" class="form-label">Password</label>
          <input type="password" class="form-control" id="vendorPassword" placeholder="Enter your password" required />
        </div>
        <button type="submit" class="btn-primary">Sign In</button>
        <div class="forgot-password">
          <a href="#" onclick="resetVendorPassword()">Forgot password?</a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Scripts -->
<script>
  function showTab(tab) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');

    document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
    document.getElementById(`${tab}-form`).classList.add('active');
  }

  function showWelcome(name) {
    const welcomeMessage = document.getElementById('welcomeMessage');
    welcomeMessage.textContent = `Welcome, ${name}`;
    
    const welcomeScreen = document.getElementById('welcomeScreen');
    welcomeScreen.style.display = 'flex';
    
    setTimeout(() => {
      welcomeScreen.classList.add('show');
    }, 50);
  }

  function handleCredentialResponse(response) {
    const payload = JSON.parse(atob(response.credential.split('.')[1]));
    const userName = payload.name || "User";

    showWelcome(userName);

    fetch('/auth-receiver/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-CSRFToken': getCookie('csrftoken')
      },
      body: 'credential=' + encodeURIComponent(response.credential)
    })
    .then(res => res.json())
    .then(data => {
      if (data.status === 'success') {
        setTimeout(() => window.location.href = '/userdashboard/', 2000);
      } else {
        alert('Login failed: ' + data.message);
        document.getElementById('welcomeScreen').style.display = 'none';
      }
    })
    .catch(err => {
      console.error('Auth error:', err);
      alert('Login failed. Please try again.');
      document.getElementById('welcomeScreen').style.display = 'none';
    });
  }

  async function vendorLogin(event) {
    event.preventDefault();
    const vendorId = document.getElementById('vendorId').value;
    const password = document.getElementById('vendorPassword').value;

    try {
      showWelcome('Vendor');
      
      // Simulate vendor login (replace with actual endpoint)
      setTimeout(() => {
        window.location.href = '/vendordashboard/';
      }, 2000);
      
    } catch (err) {
      console.error(err);
      alert('Login failed. Please try again.');
      document.getElementById('welcomeScreen').style.display = 'none';
    }
  }

  function resetVendorPassword() {
    const vendorId = prompt('Enter your Vendor ID:');
    if (vendorId) {
      alert('Password reset instructions will be sent to your registered email.');
    }
  }

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>